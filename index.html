<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Briefing — Arribos & Salidas</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <img src="assets/logo.png" class="logo" alt="logo">
      <div>
        <h1>Briefing — Arribos & Salidas</h1>
      </div>
    </div>
    <div class="controls">
      <button class="refresh-btn" id="btnRefresh">Actualizar</button>
    </div>
  </header>

  <div class="tabs" role="tablist">
    <button class="tab active" data-tab="arribos" role="tab" aria-selected="true">Arribos</button>
    <button class="tab" data-tab="salidas" role="tab" aria-selected="false">Salidas</button>
    <button class="tab" data-tab="historial" role="tab" aria-selected="false">Historial</button>
  </div>

  <div class="container">
    <section class="card" id="cardArribos" role="tabpanel" aria-labelledby="Arribos">
      <strong>Arribos</strong>
      <div class="table-wrap">
        <table id="tblArribos"><thead></thead><tbody></tbody></table>
      </div>
    </section>

    <section class="card" id="cardSalidas" role="tabpanel" aria-labelledby="Salidas" style="display:none">
      <strong>Salidas</strong>
      <div class="table-wrap">
        <table id="tblSalidas"><thead></thead><tbody></tbody></table>
      </div>
    </section>

    <section class="card" id="cardHistorial" role="tabpanel" aria-labelledby="Historial" style="display:none">
      <div class="row">
        <strong>Historial</strong>
        <input type="text" id="searchInput" placeholder="Buscar vuelo o matrícula...">
      </div>
      <div class="table-wrap">
        <table id="tblHistorial"><thead></thead><tbody></tbody></table>
      </div>
    </section>
  </div>
</div>

<!-- Tu app de UI -->
<script src="js/compat-chrome.js"></script>
<script src="js/app.js" defer></script>

<!-- JSONP para evitar CORS (robusto para móvil) -->
<script>
  // callback global que el Apps Script invoca: tu app.js lo consume si ya está cargado
  function handleGASData(rows){
    window.__GAS_ROWS__ = rows || [];
    if (window.__loadFromJSONP) window.__loadFromJSONP(window.__GAS_ROWS__);
  }
</script>
<script>
  (function(){
    // Usá SIEMPRE la URL /exec pública de tu implementación
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzr8D4fe4eWYsbR-q62dWDqZVjsctso2jMoH874nsLNtLwi1wsw_04ye_KtA4fwW13hgw/exec";

    let tries = 0, maxTries = 3, loaded = false;

    // Aviso liviano (visible en móvil si hay problemas de red)
    const note = document.createElement('div');
    note.id = "net-note";
    note.style.cssText = "margin:8px 0;padding:8px;text-align:center;font-size:.9rem;color:#444;display:none;";
    document.body.appendChild(note);

    function inject(){
      tries++;
      note.style.display = "";
      note.textContent = "Cargando datos… (intento " + tries + "/" + maxTries + ")";
      const s = document.createElement('script');
      s.async = true;
      // cache-buster para evitar versiones cacheadas en celular
      s.src = GAS_URL + "?callback=handleGASData&_ts=" + Date.now();
      s.onerror = () => {
        if (!loaded && tries < maxTries) {
          setTimeout(inject, 900);
        } else if (!loaded) {
          note.textContent = "No pude cargar datos. Verificá que el Web App esté público (Cualquiera con el enlace) y recargá.";
        }
      };
      s.onload = () => {
        loaded = true;
        note.style.display = "none";
      };
      document.body.appendChild(s);
    }

    // 3 intentos espaciados para cubrir redes móviles inestables
    inject();
    setTimeout(() => { if (!loaded && tries < maxTries) inject(); }, 2000);
    setTimeout(() => { if (!loaded && tries < maxTries) inject(); }, 4000);
  })();
</script>
</body>
</html>
